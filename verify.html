<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Verifying Email | DiaPilot</title>
    <script src="https://cdn.jsdelivr.net/npm/appwrite@13.0.0"></script>
    <style>
        /* Base */
        :root{
            --bg-1: #071028;
            --bg-2: #001223;
            --card-bg: rgba(255,255,255,0.02);
            --muted: #9aa7b9;
            --text: #e6eef8;
            --glass-border: rgba(255,255,255,0.05);
            --accent: #60a5fa;
            --success: #34d399;
            --danger: #fb7185;
        }

        html,body { height: 100%; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background: radial-gradient(1200px 600px at 10% 20%, rgba(96,165,250,0.06), transparent),
                        linear-gradient(180deg, var(--bg-1) 0%, var(--bg-2) 100%);
            color: var(--text);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 24px;
            -webkit-font-smoothing:antialiased;
            -moz-osx-font-smoothing:grayscale;
        }

        /* Card */
        .card {
            background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.015));
            border: 1px solid var(--glass-border);
            backdrop-filter: blur(8px) saturate(120%);
            padding: 36px;
            border-radius: 14px;
            box-shadow: 0 10px 30px rgba(2,6,23,0.7), 0 2px 8px rgba(59,130,246,0.03) inset;
            text-align: center;
            max-width: 420px;
            width: 100%;
            transition: transform 200ms ease, box-shadow 200ms ease;
            opacity: 0;
            transform: translateY(12px);
            animation: floatIn 420ms ease forwards;
        }
        .card:hover { transform: translateY(6px); box-shadow: 0 20px 40px rgba(2,6,23,0.8); }

        @keyframes floatIn { to { opacity: 1; transform: translateY(0); } }

        h2 { margin-top: 0; color: var(--text); font-size: 1.5rem; }
        p { color: var(--muted); line-height: 1.6; margin-bottom: 0; }

        /* Status icon */
        .status-icon {
            font-size: 40px;
            margin: 0 auto 18px auto;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 84px;
            height: 84px;
            border-radius: 50%;
            background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
            color: var(--text);
            box-shadow: 0 6px 18px rgba(2,6,23,0.6);
            transition: transform 200ms ease, box-shadow 200ms ease, background 200ms ease;
            font-weight: 600;
        }

        /* Status colors are applied to the headline; icon will subtly change via these utility classes */
        .success { color: var(--success); }
        .error { color: var(--danger); }

        /* Loader */
        .loader {
            border: 4px solid rgba(255,255,255,0.06);
            border-top: 4px solid var(--accent);
            border-radius: 50%;
            width: 44px;
            height: 44px;
            animation: spin 1s linear infinite;
            margin: 0 auto 18px auto;
            box-shadow: 0 6px 12px rgba(59,130,246,0.08) inset;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* Small helpers */
        .muted { color: var(--muted); }

        /* Responsive tweaks */
        @media (max-width: 420px) {
            .status-icon { width: 66px; height: 66px; font-size: 34px; }
            .card { padding: 28px; }
        }
    </style>
</head>
<body>
    <div class="card">
        <div id="loader" class="loader"></div>
        <div id="icon" class="status-icon"></div>
        <h2 id="status">Verifying...</h2>
        <p id="message">Please wait while we secure your account.</p>
    </div>

    <script>
        const client = new Appwrite.Client();
        const account = new Appwrite.Account(client);

        // TODO: PASTE YOUR PROJECT ID HERE
        client
            .setEndpoint('https://cloud.appwrite.io/v1')
            .setProject('69611612001dcf8e3cca'); 

        const urlParams = new URLSearchParams(window.location.search);
        const userId = urlParams.get('userId');
        const secret = urlParams.get('secret');

        account.updateVerification(userId, secret)
            .then(() => {
                document.getElementById('loader').style.display = 'none';
                document.getElementById('icon').innerHTML = '✅';
                document.getElementById('status').innerText = 'Email Verified!';
                document.getElementById('status').classList.add('success');
                document.getElementById('message').innerText = 'Thank you! Your email has been successfully verified. You can now return to the app.';
            })
            .catch((error) => {
                document.getElementById('loader').style.display = 'none';
                document.getElementById('icon').innerHTML = '⚠️';
                document.getElementById('status').innerText = 'Verification Failed';
                document.getElementById('status').classList.add('error');
                document.getElementById('message').innerText = error.message;
            });
    </script>
</body>
</html>
